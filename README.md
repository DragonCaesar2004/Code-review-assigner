# PR Reviewer Assignment Service

ะะธะบัะพัะตัะฒะธั ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฝะฐะทะฝะฐัะตะฝะธั ัะตะฒััะตัะพะฒ ะฝะฐ Pull Request'ั ะธะท ะบะพะผะฐะฝะดั ะฐะฒัะพัะฐ.

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะะฟะธัะฐะฝะธะต](#-ะพะฟะธัะฐะฝะธะต)
- [ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั](#-ััะฝะบัะธะพะฝะฐะปัะฝะพััั)
- [ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ](#-ัะตัะฝะพะปะพะณะธัะตัะบะธะน-ััะตะบ)
- [ะัััััะน ััะฐัั](#-ะฑัััััะน-ััะฐัั)
- [ะัะฟะพะปัะทะพะฒะฐะฝะธะต API](#-ะธัะฟะพะปัะทะพะฒะฐะฝะธะต-api)
- [ะััะธัะตะบัััะฐ](#-ะฐััะธัะตะบัััะฐ)
- [ะะธะทะฝะตั-ะฟัะฐะฒะธะปะฐ](#-ะฑะธะทะฝะตั-ะฟัะฐะฒะธะปะฐ)
- [ะกัะฐััั ะฒัะฟะพะปะฝะตะฝะธั ะขะ](#-ััะฐััั-ะฒัะฟะพะปะฝะตะฝะธั-ัะท)

## ๐ ะะฟะธัะฐะฝะธะต

ะกะตัะฒะธั ะฟัะตะดะพััะฐะฒะปัะตั HTTP API ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะบะพะผะฐะฝะดะฐะผะธ ัะฐะทัะฐะฑะพััะธะบะพะฒ, ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฝะฐะทะฝะฐัะตะฝะธั ัะตะฒััะฒะตัะพะฒ ะฝะฐ Pull Request'ั ะธ ัะฟัะฐะฒะปะตะฝะธั ะฟัะพัะตััะพะผ ะบะพะด-ัะตะฒัั.

### ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

- โ ะะฒัะพะผะฐัะธัะตัะบะพะต ะฝะฐะทะฝะฐัะตะฝะธะต ะดะพ 2 ัะตะฒััะฒะตัะพะฒ ะฟัะธ ัะพะทะดะฐะฝะธะธ PR
- โ ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพะผะฐะฝะดะฐะผะธ ะธ ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
- โ ะะตัะตะฝะฐะทะฝะฐัะตะฝะธะต ัะตะฒััะฒะตัะพะฒ ั ััะตัะพะผ ะบะพะผะฐะฝะดั ะทะฐะผะตะฝัะตะผะพะณะพ
- โ ะะดะตะผะฟะพัะตะฝัะฝะฐั ะพะฟะตัะฐัะธั merge
- โ ะคะธะปัััะฐัะธั ะฝะตะฐะบัะธะฒะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- โ ะะพะปััะตะฝะธะต ัะฟะธัะบะฐ PR ะดะปั ัะตะฒัั ะฟะพ ะฟะพะปัะทะพะฒะฐัะตะปั

## ๐ ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั

### ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพะผะฐะฝะดะฐะผะธ
- `POST /team/add` - ัะพะทะดะฐะฝะธะต ะบะพะผะฐะฝะดั ั ััะฐััะฝะธะบะฐะผะธ
- `GET /team/get` - ะฟะพะปััะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ ะบะพะผะฐะฝะดะต

### ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ  
- `POST /users/setIsActive` - ะธะทะผะตะฝะตะฝะธะต ััะฐัััะฐ ะฐะบัะธะฒะฝะพััะธ
- `GET /users/getReview` - ะฟะพะปััะตะฝะธะต PR ะดะปั ัะตะฒัั

### Pull Request'ั
- `POST /pullRequest/create` - ัะพะทะดะฐะฝะธะต PR ั ะฐะฒัะพะฝะฐะทะฝะฐัะตะฝะธะตะผ ัะตะฒััะฒะตัะพะฒ
- `POST /pullRequest/merge` - ะธะทะผะตะฝะตะฝะธะต ััะฐัััะฐ ะฝะฐ MERGED (ะธะดะตะผะฟะพัะตะฝัะฝะพ)
- `POST /pullRequest/reassign` - ะฟะตัะตะฝะฐะทะฝะฐัะตะฝะธะต ัะตะฒััะฒะตัะฐ

### ะกะปัะถะตะฑะฝัะต ัะฝะดะฟะพะธะฝัั
- `GET /health` - ะฟัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะตัะฒะธัะฐ

## ๐ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

- **Python 3.12** - ัะทัะบ ะฟัะพะณัะฐะผะผะธัะพะฒะฐะฝะธั
- **FastAPI** - ะฒะตะฑ-ััะตะนะผะฒะพัะบ
- **SQLAlchemy 2.0+** - ORM
- **PostgreSQL 16** - ะฑะฐะทะฐ ะดะฐะฝะฝัั
- **Alembic** - ะผะธะณัะฐัะธะธ ะะ
- **Pydantic 2.x** - ะฒะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั
- **Docker & Docker Compose** - ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั
- **pytest** - ัะตััะธัะพะฒะฐะฝะธะต
- **uv** - ัะฟัะฐะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพัััะผะธ

## โก ะัััััะน ััะฐัั

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Docker ะธ Docker Compose
- Make (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะดะปั ัะดะพะฑััะฒะฐ)

### ะะฐะฟััะบ ัะตัะฒะธัะฐ

```bash
# ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone https://github.com/DragonCaesar2004/Code-review-assigner.git
cd Code-review-assigner

# ะะฐะฟัััะธัั ัะตัะฒะธั (ะธะปะธ make up)
docker-compose up -d

# ะัะพะฒะตัะธัั ััะฐััั
curl http://localhost:8080/health
```

ะกะตัะฒะธั ะฑัะดะตั ะดะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั: **http://localhost:8080**  
Swagger UI: **http://localhost:8080/docs**

### ะััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะฐ

```bash
# ะััะฐะฝะพะฒะธัั ัะตัะฒะธั (ะธะปะธ make down)
docker-compose down

# ะะพะปะฝะฐั ะพัะธััะบะฐ (ะฒะบะปััะฐั volumes)
docker-compose down -v
```

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต API

### ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ

#### 1. ะกะพะทะดะฐัั ะบะพะผะฐะฝะดั

```bash
curl -X POST http://localhost:8080/team/add \
  -H "Content-Type: application/json" \
  -d '{
    "team_name": "backend",
    "members": [
      {"user_id": "u1", "username": "Alice", "is_active": true},
      {"user_id": "u2", "username": "Bob", "is_active": true},
      {"user_id": "u3", "username": "Charlie", "is_active": true}
    ]
  }'
```

#### 2. ะกะพะทะดะฐัั PR (ะฐะฒัะพะฝะฐะทะฝะฐัะตะฝะธะต ัะตะฒััะฒะตัะพะฒ)

```bash
curl -X POST http://localhost:8080/pullRequest/create \
  -H "Content-Type: application/json" \
  -d '{
    "pull_request_id": "pr-1001",
    "pull_request_name": "Add search feature",
    "author_id": "u1"
  }'
```

ะัะฒะตั ะฑัะดะตั ัะพะดะตัะถะฐัั ะดะพ 2 ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐะทะฝะฐัะตะฝะฝัั ัะตะฒััะฒะตัะพะฒ ะธะท ะบะพะผะฐะฝะดั ะฐะฒัะพัะฐ (ะบัะพะผะต ัะฐะผะพะณะพ ะฐะฒัะพัะฐ).

#### 3. ะะตะฐะบัะธะฒะธัะพะฒะฐัั ะฟะพะปัะทะพะฒะฐัะตะปั

```bash
curl -X POST http://localhost:8080/users/setIsActive \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "u2",
    "is_active": false
  }'
```

#### 4. ะะตัะตะฝะฐะทะฝะฐัะธัั ัะตะฒััะฒะตัะฐ

```bash
curl -X POST http://localhost:8080/pullRequest/reassign \
  -H "Content-Type: application/json" \
  -d '{
    "pull_request_id": "pr-1001",
    "old_user_id": "u2"
  }'
```

#### 5. Merge PR

```bash
curl -X POST http://localhost:8080/pullRequest/merge \
  -H "Content-Type: application/json" \
  -d '{
    "pull_request_id": "pr-1001"
  }'
```

#### 6. ะะพะปััะธัั PR ะดะปั ัะตะฒัั

```bash
curl http://localhost:8080/users/getReview?user_id=u2
```

### ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั API

OpenAPI ัะฟะตัะธัะธะบะฐัะธั: `openapi.yaml`  
Swagger UI: http://localhost:8080/docs  
ReDoc: http://localhost:8080/redoc

### Makefile ะบะพะผะฐะฝะดั

```bash
make help         # ะะพะบะฐะทะฐัั ะฒัะต ะดะพัััะฟะฝัะต ะบะพะผะฐะฝะดั
make up           # ะะฐะฟัััะธัั ัะตัะฒะธั
make down         # ะััะฐะฝะพะฒะธัั ัะตัะฒะธั
make logs         # ะะพะบะฐะทะฐัั ะปะพะณะธ
make test         # ะะฐะฟัััะธัั ัะตััั
make test-cov     # ะขะตััั ั ะฟะพะบัััะธะตะผ
make clean        # ะัะธััะธัั ะบะพะฝัะตะนะฝะตัั ะธ volumes
make migrate      # ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธะธ
make lint         # ะัะพะฒะตัะธัั ะบะพะด ะปะธะฝัะตัะพะผ
make format       # ะคะพัะผะฐัะธัะพะฒะฐัั ะบะพะด
```


## ๐ ะััะธัะตะบัััะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
.
โโโ src/
โ   โโโ api/              # API endpoints (FastAPI ัะพััะตัั)
โ   โ   โโโ teams.py
โ   โ   โโโ users.py
โ   โ   โโโ pull_requests.py
โ   โ   โโโ health.py
โ   โโโ crud/             # ะกะปะพะน ัะฐะฑะพัั ั ะะ
โ   โ   โโโ base.py       # ะะฐะทะพะฒัะน CRUD ะบะปะฐัั
โ   โ   โโโ team.py
โ   โ   โโโ user.py
โ   โ   โโโ pull_request.py
โ   โ   โโโ pr_reviewer.py
โ   โโโ models/           # SQLAlchemy ะผะพะดะตะปะธ
โ   โ   โโโ team.py
โ   โ   โโโ user.py
โ   โ   โโโ pull_request.py
โ   โ   โโโ pr_reviewer.py
โ   โโโ schemas/          # Pydantic ััะตะผั
โ   โ   โโโ team.py
โ   โ   โโโ user.py
โ   โ   โโโ pull_request.py
โ   โ   โโโ error.py
โ   โโโ services/         # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โ   โโโ team_service.py
โ   โ   โโโ user_service.py
โ   โ   โโโ pull_request_service.py
โ   โ   โโโ reviewer_assignment_service.py
โ   โโโ main.py           # ะขะพัะบะฐ ะฒัะพะดะฐ FastAPI
โโโ tests/                # ะขะตััั
โ   โโโ conftest.py       # Pytest ัะธะบััััั
โ   โโโ test_e2e.py       # E2E ัะตััั
โ   โโโ test_services.py  # Unit-ัะตััั ัะตัะฒะธัะพะฒ
โโโ migrations/           # Alembic ะผะธะณัะฐัะธะธ
โโโ docker-compose.yml    # Docker ะบะพะฝัะธะณััะฐัะธั
โโโ Dockerfile
โโโ openapi.yaml          # OpenAPI ัะฟะตัะธัะธะบะฐัะธั
โโโ Makefile             # ะะพะผะฐะฝะดั ะดะปั ัะฐะทัะฐะฑะพัะบะธ
โโโ README.md
```

### ะกะปะพะธ ะฟัะธะปะพะถะตะฝะธั

1. **API Layer** (`src/api/`) - FastAPI ัะพััะตัั, ะพะฑัะฐะฑะพัะบะฐ HTTP ะทะฐะฟัะพัะพะฒ
2. **Service Layer** (`src/services/`) - ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ, ะพัะบะตัััะฐัะธั ะพะฟะตัะฐัะธะน
3. **CRUD Layer** (`src/crud/`) - ะพะฟะตัะฐัะธะธ ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
4. **Models Layer** (`src/models/`) - SQLAlchemy ะผะพะดะตะปะธ ะะ

### ะกัะตะผะฐ ะฑะฐะทั ะดะฐะฝะฝัั

**ะะพะดะตะปะธ:**
- `Team` - ะบะพะผะฐะฝะดั ัะฐะทัะฐะฑะพััะธะบะพะฒ
- `User` - ะฟะพะปัะทะพะฒะฐัะตะปะธ ั ัะปะฐะณะพะผ ะฐะบัะธะฒะฝะพััะธ
- `PullRequest` - Pull Request'ั ัะพ ััะฐัััะพะผ (OPEN/MERGED)
- `PRReviewer` - ัะฒัะทั many-to-many ะผะตะถะดั PR ะธ ัะตะฒััะฒะตัะฐะผะธ

**ะกะฒัะทะธ:**

```
โโโโโโโโโโโโโโโโ
โ    Team      โ
โ              โ
โ team_name PK โ
โโโโโโโโฌโโโโโโโโ
       โ 1
       โ
       โ N
โโโโโโโโดโโโโโโโโโโโโโโโโโโโโ
โ        User              โ
โ                          โ
โ user_id PK               โ
โ username                 โ
โ team_name FK             โ
โ is_active                โ
โโโโโโโโฌโโโโโโโโโโโโฌโโโโโโโโ
       โ 1         โ N
       โ           โ
       โ N         โโโโโโโโโโโโโโโโ
โโโโโโโโดโโโโโโโโโโโโโโโ           โ
โ   PullRequest       โ           โ
โ                     โ           โ N
โ pull_request_id PK  โ    โโโโโโโโดโโโโโโโโโโโโโโ
โ pull_request_name   โ    โ   PRReviewer       โ
โ author_id FK        โ    โ                    โ
โ status              โ 1  โ id PK              โ
โ created_at          โโโโโโค pull_request_id FK โ
โ merged_at           โ N  โ reviewer_id FK     โ
โโโโโโโโโโโโโโโโโโโโโโโ    โ assigned_at        โ
                           โโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ ะะธะทะฝะตั-ะฟัะฐะฒะธะปะฐ

### ะะฐะทะฝะฐัะตะฝะธะต ัะตะฒััะฒะตัะพะฒ
1. ะัะธ ัะพะทะดะฐะฝะธะธ PR ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐะทะฝะฐัะฐัััั **ะดะพ 2 ะฐะบัะธะฒะฝัั ัะตะฒััะฒะตัะพะฒ** ะธะท ะบะพะผะฐะฝะดั ะฐะฒัะพัะฐ
2. ะะฒัะพั PR **ะธัะบะปััะฐะตััั** ะธะท ะบะฐะฝะดะธะดะฐัะพะฒ ะฝะฐ ัะตะฒัั
3. ะะพะปัะทะพะฒะฐัะตะปะธ ั `is_active=false` **ะฝะต ะฝะฐะทะฝะฐัะฐัััั** ะฝะฐ ัะตะฒัั
4. ะัะปะธ ะดะพัััะฟะฝัั ะบะฐะฝะดะธะดะฐัะพะฒ ะผะตะฝััะต 2, ะฝะฐะทะฝะฐัะฐะตััั ะดะพัััะฟะฝะพะต ะบะพะปะธัะตััะฒะพ (0/1)
5. ะัะฑะพั ัะตะฒััะฒะตัะพะฒ **ัะปััะฐะนะฝัะน** (random.sample)

### ะะตัะตะฝะฐะทะฝะฐัะตะฝะธะต
1. ะะพะฒัะน ัะตะฒััะฒะตั ะฒัะฑะธัะฐะตััั ะธะท ะบะพะผะฐะฝะดั **ะทะฐะผะตะฝัะตะผะพะณะพ ัะตะฒััะฒะตัะฐ** (ะฝะต ะฐะฒัะพัะฐ PR)
2. ะัะบะปััะฐัััั: ะฐะฒัะพั PR, ัะตะบััะธะต ัะตะฒััะฒะตัั, ะฝะตะฐะบัะธะฒะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ
3. ะะตัะตะฝะฐะทะฝะฐัะตะฝะธะต **ะทะฐะฟัะตัะตะฝะพ** ะฟะพัะปะต merge PR
4. ะะพะถะฝะพ ะฟะตัะตะฝะฐะทะฝะฐัะธัั ัะพะปัะบะพ ะฟะพะปัะทะพะฒะฐัะตะปั, ะบะพัะพััะน ะฝะฐะทะฝะฐัะตะฝ ัะตะฒััะฒะตัะพะผ

### Merge
1. ะะฟะตัะฐัะธั **ะธะดะตะผะฟะพัะตะฝัะฝะฐั** - ะฟะพะฒัะพัะฝัะน ะฒัะทะพะฒ ะฝะต ะฒัะทัะฒะฐะตั ะพัะธะฑะบั
2. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั `status=MERGED` ะธ `merged_at`
3. ะะพัะปะต merge ะธะทะผะตะฝะตะฝะธะต ัะตะฒััะฒะตัะพะฒ **ะทะฐะฟัะตัะตะฝะพ**

### ะะพะผะฐะฝะดั ะธ ะฟะพะปัะทะพะฒะฐัะตะปะธ
1. `POST /team/add` ัะพะทะดะฐัั ะธะปะธ **ะพะฑะฝะพะฒะปัะตั** ะธะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปัั
2. ะัะธ ัะดะฐะปะตะฝะธะธ ะบะพะผะฐะฝะดั **ะบะฐัะบะฐะดะฝะพ ัะดะฐะปััััั** ะฒัะต ััะฐััะฝะธะบะธ
3. ะัะธ ัะดะฐะปะตะฝะธะธ PR **ะบะฐัะบะฐะดะฝะพ ัะดะฐะปััััั** ะฒัะต ะฝะฐะทะฝะฐัะตะฝะธั ัะตะฒััะฒะตัะพะฒ

## ๐ ะกัะฐััั ะฒัะฟะพะปะฝะตะฝะธั ะขะ

### ะัะฝะพะฒะฝัะต ััะตะฑะพะฒะฐะฝะธั โ
- โ ะะฒัะพะผะฐัะธัะตัะบะพะต ะฝะฐะทะฝะฐัะตะฝะธะต ะดะพ 2 ัะตะฒััะฒะตัะพะฒ ะฟัะธ ัะพะทะดะฐะฝะธะธ PR
- โ ะะตัะตะฝะฐะทะฝะฐัะตะฝะธะต ัะตะฒััะฒะตัะพะฒ ะธะท ะบะพะผะฐะฝะดั ะทะฐะผะตะฝัะตะผะพะณะพ
- โ ะะฐะฟัะตั ะธะทะผะตะฝะตะฝะธั ัะตะฒััะฒะตัะพะฒ ะฟะพัะปะต merge
- โ ะะดะตะผะฟะพัะตะฝัะฝะฐั ะพะฟะตัะฐัะธั merge
- โ ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพะผะฐะฝะดะฐะผะธ ะธ ััะฐััะฝะธะบะฐะผะธ
- โ ะคะปะฐะณ `isActive` ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- โ ะัะต endpoints ัะพะณะปะฐัะฝะพ OpenAPI ัะฟะตัะธัะธะบะฐัะธะธ
- โ Docker Compose ะดะปั ะทะฐะฟััะบะฐ (ะฟะพัั 8080)
- โ ะะฒัะพะผะฐัะธัะตัะบะพะต ะฟัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน
